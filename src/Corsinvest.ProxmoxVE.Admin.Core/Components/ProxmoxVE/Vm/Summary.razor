@*
 * SPDX-FileCopyrightText: Copyright Corsinvest Srl
 * SPDX-License-Identifier: AGPL-3.0-only
*@
@inherits AdminComponentBase

@if (Status == null)
{
    <RadzenProgressBar ProgressBarStyle="ProgressBarStyle.Primary" Value="100" ShowValue="false" Mode="ProgressBarMode.Indeterminate" />
}
else
{
    <RadzenRow>
        <RadzenColumn Size="6">
            <RadzenTable Style="border:none;">
                @RenderRow("schedule", "Uptime", FormatHelper.UptimeInfo(Status.Uptime))

                <RadzenTableRow>
                    <RadzenTableCell Style="border:none;" colspan="2">
                        @RenderTitle(PveAdminUIHelper.Icons.Cpu, "CPU", Status.CpuInfo)
                        @RenderProgress(Status.CpuUsagePercentage * 100)
                    </RadzenTableCell>
                </RadzenTableRow>

                @if (Vm.VmType == VmType.Lxc && Status != null)
                {
                    <RadzenTableRow>
                        <RadzenTableCell Style="border:none;" colspan="2">
                            @RenderTitle(PveAdminUIHelper.Icons.Storage, "SWAP", FormatHelper.UsageInfo(((VmLxcStatusCurrent)Status).SwapUsage, ((VmLxcStatusCurrent)Status).SwapSize))
                            @RenderProgress(((VmLxcStatusCurrent)Status).SwapUsagePercentage * 100)
                        </RadzenTableCell>
                    </RadzenTableRow>
                }

                @if (Status != null)
                {
                    <RadzenTableRow>
                        <RadzenTableCell Style="border:none;" colspan="2">
                            @RenderTitle(PveAdminUIHelper.Icons.Storage, "Bootdisk", FormatHelper.FromBytes(Status.DiskSize))
                        </RadzenTableCell>
                    </RadzenTableRow>
                }
            </RadzenTable>
        </RadzenColumn>

        <RadzenColumn Size="6">
            <RadzenTable Style="border:none;">
                <RadzenTableRow>
                    <RadzenTableCell Style="border:none;">
                        <RadzenStack Orientation="Orientation.Horizontal">
                            <div style="width: 5px;">
                                <Corsinvest.ProxmoxVE.Admin.Core.Components.ProxmoxVE.Common.IconStatusResource Status="@Vm.Status" Type="@Vm.Type" />
                            </div>
                            <RadzenText TextStyle="TextStyle.Body2"><strong>@L["Status"]</strong></RadzenText>
                        </RadzenStack>
                    </RadzenTableCell>

                    <RadzenTableCell Style="border:none; text-align: end;">
                        <RadzenBadge BadgeStyle="@PveAdminUIHelper.ToBadgeStyle(PveAdminUIHelper.GetResourcesColorStatus(Vm.Status, false))"
                                     Text="@L[Vm.Status]"
                                     Style="height: max-content;" />
                    </RadzenTableCell>
                </RadzenTableRow>

                <RadzenTableRow>
                    <RadzenTableCell Style="border:none;" colspan="2">
                        @RenderTitle(PveAdminUIHelper.Icons.Memory, "Memory Usage", Status.MemoryInfo)
                        @RenderProgress(Status.MemoryUsagePercentage * 100)
                    </RadzenTableCell>
                </RadzenTableRow>
            </RadzenTable>
        </RadzenColumn>
    </RadzenRow>
}

@code
{
    private RenderFragment RenderRow(string icon, string title, string value) => __builder =>
    {
        <RadzenTableRow>
            <RadzenTableCell Style="border:none;">
                <RadzenStack Orientation="Orientation.Horizontal" Gap="5px">
                    <RadzenIcon Icon="@icon" />
                    <RadzenText TextStyle="TextStyle.Body2"><strong>@L[title]</strong></RadzenText>
                </RadzenStack>
            </RadzenTableCell>

            <RadzenTableCell Style="border:none; text-align: end;">
                <RadzenText TextStyle="TextStyle.Body2" Text="@value" />
            </RadzenTableCell>
        </RadzenTableRow>
    };

    private RenderFragment RenderTitle(string icon, string title, string value) => __builder =>
    {
        <RadzenStack Orientation="Orientation.Horizontal" Gap="5px">
            @if (!string.IsNullOrEmpty(icon))
            {
                <RadzenIcon Icon="@icon" />
            }
            <RadzenText TextStyle="TextStyle.Body2" class="rz-w-100"><strong>@L[title]</strong></RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" Text="@value" />
        </RadzenStack>
    };

    private RenderFragment RenderProgress(double value) => __builder =>
    {
        <RadzenProgressBar Value="@value"
                           ShowValue="false"
                           class="rz-w-100"
                           ProgressBarStyle="@PveAdminUIHelper.ToProgressBarStyle(PveAdminUIHelper.GetColorRange(value))" />
    };
}
